# MongoDB Configuration for High Performance Big Data Analytics
# Optimized for streaming data ingestion and analytics workloads

# Network Configuration
net:
  port: 27017
  bindIp: 0.0.0.0
  maxIncomingConnections: 1000
  wireObjectCheck: false
  compression:
    compressors: snappy,zstd

# Storage Configuration - Optimized for high throughput
storage:
  dbPath: /data/db
  journal:
    enabled: true
    commitIntervalMs: 100
  directoryPerDB: true
  syncPeriodSecs: 60
  engine: wiredTiger
  wiredTiger:
    engineConfig:
      cacheSizeGB: 2
      journalCompressor: snappy
      directoryForIndexes: true
      maxCacheOverflowFileSizeGB: 0.5
    collectionConfig:
      blockCompressor: snappy
    indexConfig:
      prefixCompression: true

# System Log Configuration
systemLog:
  destination: file
  logAppend: true
  path: /data/logs/mongod.log
  component:
    accessControl:
      verbosity: 0
    command:
      verbosity: 0
    control:
      verbosity: 0
    executor:
      verbosity: 0
    geo:
      verbosity: 0
    index:
      verbosity: 0
    network:
      verbosity: 0
    query:
      verbosity: 0
    replication:
      verbosity: 0
    sharding:
      verbosity: 0
    storage:
      verbosity: 0
    write:
      verbosity: 0

# Process Management
processManagement:
  fork: false
  pidFilePath: /var/run/mongod.pid

# Security Configuration
security:
  authorization: enabled
  javascriptEnabled: true

# Operation Profiling - For performance monitoring
operationProfiling:
  mode: slowOp
  slowOpThresholdMs: 1000
  slowOpSampleRate: 1.0

# Replication (if needed for scaling)
replication:
  oplogSizeMB: 2048
  enableMajorityReadConcern: true

# Sharding Configuration (prepared for horizontal scaling)
# sharding:
#   clusterRole: shardsvr

# Set Parameters - Performance optimizations
setParameter:
  # Connection management
  connPoolMaxShardedConnsPerHost: 200
  connPoolMaxConnsPerHost: 200

  # Query execution
  internalQueryMaxBlockingSortMemoryUsageBytes: 134217728  # 128MB
  internalQueryExecMaxBlockingSortBytes: 134217728         # 128MB

  # Index builds
  maxIndexBuildMemoryUsageMegabytes: 1024                  # 1GB for index builds

  # Write operations
  journalCommitInterval: 100                               # 100ms commit interval
  syncdelay: 60                                           # 60s sync delay

  # Read operations
  internalQueryPlanEvaluationWorks: 10000                 # More evaluation works
  internalQueryPlanEvaluationCollFraction: 0.3           # Collection fraction

  # Memory management
  tcmallocAggressiveMemoryDecommit: true                  # Aggressive memory decommit

  # Logging
  logLevel: 0                                             # Only log errors/warnings
  quiet: false                                            # Don't suppress logs

  # Network
  notablescan: false                                      # Allow table scans for analytics

  # Oplog
  replBatchLimitOperations: 5000                          # Larger replication batches

  # Storage
  wiredTigerConcurrentReadTransactions: 128               # More concurrent reads
  wiredTigerConcurrentWriteTransactions: 128              # More concurrent writes

  # Aggregation
  internalQueryMaxAddToSetBytes: 134217728                # 128MB for $addToSet
  internalQueryMaxPushBytes: 134217728                    # 128MB for $push

  # Text search
  textSearchEnabled: true                                 # Enable text search

  # GridFS
  chunkSize: 261120                                       # 255KB chunk size for GridFS

# Runtime options for big data workloads
runtime:
  # Disable transparent huge pages for consistent performance
  transparentHugePages: never

  # Set appropriate ulimits
  ulimit:
    fileDescriptors: 65536
    processes: 32768
    virtualMemory: unlimited